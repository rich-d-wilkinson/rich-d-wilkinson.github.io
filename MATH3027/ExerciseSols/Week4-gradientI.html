<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Prof.&nbsp;Richard Wilkinson">

<title>Week 4 - gradient descent I: exercise solutions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="Week4-gradientI_files/libs/clipboard/clipboard.min.js"></script>
<script src="Week4-gradientI_files/libs/quarto-html/quarto.js"></script>
<script src="Week4-gradientI_files/libs/quarto-html/popper.min.js"></script>
<script src="Week4-gradientI_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Week4-gradientI_files/libs/quarto-html/anchor.min.js"></script>
<link href="Week4-gradientI_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Week4-gradientI_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Week4-gradientI_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Week4-gradientI_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Week4-gradientI_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Week 4 - gradient descent I: exercise solutions</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Prof.&nbsp;Richard Wilkinson </p>
            </div>
    </div>
      
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#question-1" id="toc-question-1" class="nav-link active" data-scroll-target="#question-1">Question 1</a></li>
  <li><a href="#question-2" id="toc-question-2" class="nav-link" data-scroll-target="#question-2">Question 2</a></li>
  <li><a href="#question-3" id="toc-question-3" class="nav-link" data-scroll-target="#question-3">Question 3</a></li>
  <li><a href="#question-4" id="toc-question-4" class="nav-link" data-scroll-target="#question-4">Question 4</a></li>
  <li><a href="#question-5" id="toc-question-5" class="nav-link" data-scroll-target="#question-5">Question 5</a></li>
  <li><a href="#question-6" id="toc-question-6" class="nav-link" data-scroll-target="#question-6">Question 6</a></li>
  <li><a href="#question-7" id="toc-question-7" class="nav-link" data-scroll-target="#question-7">Question 7</a></li>
  <li><a href="#question-8" id="toc-question-8" class="nav-link" data-scroll-target="#question-8">Question 8</a></li>
  <li><a href="#question-9" id="toc-question-9" class="nav-link" data-scroll-target="#question-9">Question 9</a></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="hidden">

</div>
<section id="question-1" class="level2">
<h2 class="anchored" data-anchor-id="question-1">Question 1</h2>
<p>Suppose that <span class="math inline">\(f\)</span> is continuously differentiable, and that <span class="math inline">\(\mathbf{d}\)</span> is a descent direction of <span class="math inline">\(f\)</span> at <span class="math inline">\(\mathbf{x}\)</span>. Prove that there exists <span class="math inline">\(\varepsilon&gt;0\)</span> such that <span class="math display">\[f(\mathbf{x})-f(\mathbf{x}+t \mathbf{d}) \geq-\alpha t \nabla f(\mathbf{x})^{\top} \mathbf{d}
\quad \forall t \in [0, \varepsilon].\]</span></p>
<div class="callout-note callout callout-style-simple no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This is called the <em>sufficient decrease condition</em>. The term on the right is positive (as <span class="math inline">\(\nabla f(\mathbf{x})^\top \mathbf{d}\)</span> is negative as <span class="math inline">\(\mathbf{d}\)</span> is a descent direction), and so the condition is telling us that we can find a stepsize <span class="math inline">\(t\)</span> such that the decrease <span class="math inline">\(f(\mathbf{x}) -f(\mathbf{x}-t\mathbf{d})\)</span> is at least bigger than <span class="math inline">\(\alpha t \nabla f(\mathbf{x})^{\top}\)</span>.</p>
<p>How do we prove it? The terms <span class="math inline">\(f(\mathbf{x}), f(\mathbf{x}+t\mathbf{d})\)</span> and <span class="math inline">\(\nabla f(\mathbf{x})\)</span> all appear in the linear approximation theorem, so let’s start with that:</p>
<p><span class="math display">\[f(\mathbf{x}+t\mathbf{d})=f(\mathbf{x})+t\nabla f(\mathbf{x})^\top \mathbf{d}+ o(t\|\mathbf{d}\|)\]</span></p>
<p>Hence <span id="eq-SDC"><span class="math display">\[
f(\mathbf{x})-f(\mathbf{x}+ t\mathbf{d}) = -\alpha t \nabla f(\mathbf{x})^\top \mathbf{d}-(1-\alpha)t\nabla f(\mathbf{x})^\top \mathbf{d}-o(t\|\mathbf{d}\|)
\tag{1}\]</span></span></p>
<p>Since <span class="math inline">\(\mathbf{d}\)</span> is a descent direction, we know <span class="math display">\[\lim_{t\rightarrow 0^+} \frac{(1-\alpha)t\nabla f(\mathbf{x})^\top \mathbf{d}+o(t\|\mathbf{d}\|)}{t} = (1-\alpha)\nabla f(\mathbf{x})^\top \mathbf{d}&lt;0\]</span> Thus, there exists <span class="math inline">\(\varepsilon\)</span> such that for all <span class="math inline">\(t\in [0, \varepsilon]\)</span> <span class="math display">\[(1-\alpha)t\nabla f(\mathbf{x})^\top \mathbf{d}+o(t\|\mathbf{d}\|)&lt;0\]</span> Combining this with <a href="#eq-SDC">Equation&nbsp;1</a> gives</p>
<p><span class="math display">\[f(\mathbf{x})-f(\mathbf{x}+ t\mathbf{d}) \geq -\alpha t \nabla f(\mathbf{x})^\top \mathbf{d}\]</span> as required.</p>
</div>
</div>
</div>
</section>
<section id="question-2" class="level2">
<h2 class="anchored" data-anchor-id="question-2">Question 2</h2>
<p> Find the exact stepsize when <span class="math inline">\(f(\mathbf{x})\)</span> is a quadratic function <span class="math display">\[f(\mathbf{x})=\mathbf{x}^{\top} \mathbf{A}\mathbf{x}+2 \mathbf{b}^{\top} \mathbf{x}+c\]</span> where <span class="math inline">\(\mathbf{A}\)</span> is an <span class="math inline">\(n \times n\)</span> positive definite matrix, <span class="math inline">\(\mathbf{b}\in \mathbb{R}^{n}\)</span>, and <span class="math inline">\(c \in \mathbb{R}.\)</span> Let <span class="math inline">\(\mathbf{x}\in \mathbb{R}^{n}\)</span> and let <span class="math inline">\(\mathbf{d}\in \mathbb{R}^{n}\)</span> be a descent direction of <span class="math inline">\(f\)</span> at <span class="math inline">\(\mathbf{x}.\)</span> In other words, your objective is to find a solution to <span class="math display">\[\begin{align*}
    \min _{t \geq 0} f(\mathbf{x}+t \mathbf{d})\,.
\end{align*}\]</span></p>
<div class="callout-note callout callout-style-simple no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><span class="math display">\[\begin{align}
f(\mathbf{x}+t\mathbf{d}) &amp;= (\mathbf{x}+t\mathbf{d})^\top\mathbf{A}(\mathbf{x}+t\mathbf{d})+2\mathbf{b}^\top \mathbf{x}+c\\
&amp;=t^2\mathbf{d}^\top\mathbf{A}\mathbf{d}+2t(\mathbf{d}^\top \mathbf{A}\mathbf{x}+\mathbf{b}^\top\mathbf{d})+const
\end{align}\]</span> where the constant doesn’t depend on <span class="math inline">\(t\)</span>. If we differentiate with respect to <span class="math inline">\(t\)</span> we find</p>
<p><span class="math display">\[\begin{align}
\frac{\partial}{\partial t}f(\mathbf{x}+t\mathbf{d}) &amp;=2t\mathbf{d}^\top\mathbf{A}\mathbf{d}+2(\mathbf{d}^\top \mathbf{A}\mathbf{x}+\mathbf{b}^\top\mathbf{d})\\
&amp;= 2t \mathbf{d}^\top \mathbf{A}\mathbf{d}+ \mathbf{d}^\top \nabla f(\mathbf{x})
\end{align}\]</span> If we set this equal to zero and rearrange we find <span class="math display">\[t^* = -\frac{\mathbf{d}^\top \nabla f(\mathbf{x})}{2\mathbf{d}^\top \mathbf{A}\mathbf{d}}.\]</span></p>
</div>
</div>
</div>
</section>
<section id="question-3" class="level2">
<h2 class="anchored" data-anchor-id="question-3">Question 3</h2>
<p>Consider <span class="math display">\[\begin{align*}
    \min x_1^{2}+2 x_2^{2}.
\end{align*}\]</span> Write down the gradient descent algorithm using</p>
<ul>
<li>a fixed stepsize of <span class="math inline">\(t= 0.1\)</span></li>
<li>exact line search</li>
<li>backtracking and parameters <span class="math inline">\(\mathbf{x}^{0}=(2,1), s=2, \alpha=0.25, \beta=0.5,\)</span> and <span class="math inline">\(\varepsilon=10^{-5}\)</span></li>
</ul>
<p>Implement each case on a computer, check you get the same results as shown in the notes, and record how many steps are required for the algorithm to converge. Plot the three different trajectories on the same figure.</p>
<p>For the fixed stepsize method, what is the largest stepsize that can used and the algorithm still converge?</p>
<div class="callout-note callout callout-style-simple no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Start by implementing a function to compute f and its gradient, and check this calculation numerically.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>f<span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  x[<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>x[<span class="dv">2</span>]<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">2</span><span class="sc">*</span>x[<span class="dv">1</span>], <span class="dv">4</span><span class="sc">*</span>x[<span class="dv">2</span>])</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(numDeriv)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">c</span>(<span class="fl">1.23</span>, <span class="fl">2.34</span>) <span class="co"># its a good idea not to check your derivatives with x=1 or 0, as multiplicative or additive errors can then be missed.</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>numDeriv<span class="sc">::</span><span class="fu">grad</span>(f,x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.46 9.36</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">g</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.46 9.36</code></pre>
</div>
</div>
<p>In the previous exercise we have shown that the exact stepsize is <span class="math display">\[t^* = -\frac{\mathbf{d}^\top \nabla f(\mathbf{x})}{2\mathbf{d}^\top \mathbf{A}\mathbf{d}}\]</span></p>
<p>so the algorithm iterates using the rule <span class="math display">\[\mathbf{x}^{k+1}=\mathbf{x}^k-t^* \nabla f(\mathbf{x}^k)\]</span></p>
<p>I have written a collection of functions implementing the methods in this chapter and put them on Moodle. If you download this file and put it in your working directory, you can then load the functions as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">'GradientDescentFunctions.R'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<p>I’ll print out the function definitions so that you can see how the code is structured. Before looking at my code, you should try writing your own versions first!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(graddesc_const_step)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (f, g, x0, tbar, epsilon, Print = FALSE, maxiter = 10^4) 
{
    x = x0
    grad = g(x)
    print(grad)
    iter = 1
    trajectory &lt;- matrix(0, nr = maxiter, nc = length(x0))
    trajectory[1, ] &lt;- x
    while (sum(grad^2) &gt; epsilon^2 &amp;&amp; iter &lt; maxiter) {
        iter = iter + 1
        x = x - tbar * grad
        grad = g(x)
        trajectory[iter, ] &lt;- x
        if (Print) {
            fun_val = f(x)
            print(paste("-------------- Iteration ", iter, " -------------"))
            print(paste("f(x) = ", signif(fun_val, 3), " norm_grad = ", 
                signif(sqrt(sum(grad^2)), 3)))
            print("x = ")
            print(x)
            print(grad)
        }
    }
    return(list(x.opt = x, trajectory = trajectory[1:iter, ], 
        iter = iter - 1))
}</code></pre>
</div>
</div>
<p>Firstly, lets do gradient descent with constant step size.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>out_const <span class="ot">&lt;-</span> <span class="fu">graddesc_const_step</span>(f,g,<span class="at">x0=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">tbar=</span><span class="fl">0.1</span>, <span class="at">epsilon=</span><span class="dv">10</span><span class="sc">^</span>{<span class="sc">-</span><span class="dv">5</span>}, <span class="at">Print=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(out_const<span class="sc">$</span>iter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 58</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(out_const<span class="sc">$</span>x.opt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.789049e-06 1.357602e-13</code></pre>
</div>
</div>
<p>Now we’ll try the exact stepsize method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(graddesc_exact_step_quadratic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (A, b, x0, epsilon, maxiter = 10^6, Print = FALSE) 
{
    x = x0
    iter = 1
    grad = 2 * (A %*% x + b)
    trajectory &lt;- matrix(0, nr = maxiter, nc = length(x0))
    trajectory[1, ] &lt;- x
    while (sum(grad^2) &gt; epsilon^2 &amp;&amp; iter &lt; maxiter) {
        iter = iter + 1
        tbar = c(sum(grad^2)/(2 * t(grad) %*% A %*% grad))
        x = x - tbar * grad
        fun_val = t(x) %*% A %*% x + t(b) %*% x
        grad = 2 * (A %*% x + b)
        trajectory[iter, ] &lt;- x
        if (Print) {
            print(paste("-------------- Iteration ", iter, " -------------"))
            print(paste("f(x) = ", signif(fun_val, 3), " norm_grad = ", 
                signif(sqrt(sum(grad^2)), 3)))
        }
    }
    return(list(x.opt = x, trajectory = trajectory[1:iter, ], 
        iter = iter - 1))
}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>A<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>), <span class="at">nr=</span><span class="dv">2</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>b<span class="ot">=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>x0 <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>eps <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">^</span>{<span class="sc">-</span><span class="dv">5</span>}</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>(out_exact <span class="ot">&lt;-</span> <span class="fu">graddesc_exact_step_quadratic</span>(A,b,<span class="at">x0=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">epsilon=</span><span class="dv">10</span><span class="sc">^</span>{<span class="sc">-</span><span class="dv">5</span>}, <span class="at">Print=</span><span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$x.opt
              [,1]
[1,]  1.254451e-06
[2,] -6.272255e-07

$trajectory
              [,1]          [,2]
 [1,] 2.000000e+00  1.000000e+00
 [2,] 6.666667e-01 -3.333333e-01
 [3,] 2.222222e-01  1.111111e-01
 [4,] 7.407407e-02 -3.703704e-02
 [5,] 2.469136e-02  1.234568e-02
 [6,] 8.230453e-03 -4.115226e-03
 [7,] 2.743484e-03  1.371742e-03
 [8,] 9.144947e-04 -4.572474e-04
 [9,] 3.048316e-04  1.524158e-04
[10,] 1.016105e-04 -5.080526e-05
[11,] 3.387018e-05  1.693509e-05
[12,] 1.129006e-05 -5.645029e-06
[13,] 3.763353e-06  1.881676e-06
[14,] 1.254451e-06 -6.272255e-07

$iter
[1] 13</code></pre>
</div>
</div>
<p>Finally, let’s do gradient descent with backtracking:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(graddesc_backtracking)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (f, g, x0, s, alpha, beta, epsilon, Print = FALSE, maxiter = 10^6) 
{
    stopifnot(beta &gt; 0, beta &lt; 1, alpha &gt; 0, alpha &lt; 1)
    x = x0
    grad = g(x)
    fun_val = f(x)
    iter = 1
    trajectory &lt;- matrix(0, nr = maxiter, nc = length(x0))
    trajectory[1, ] &lt;- x
    while (sum(grad^2) &gt; epsilon^2 &amp;&amp; iter &lt; maxiter) {
        iter = iter + 1
        tbar = s
        while (fun_val - f(x - tbar * grad) &lt; alpha * tbar * 
            sum(grad^2)) {
            tbar = beta * tbar
        }
        x = x - tbar * grad
        fun_val = f(x)
        grad = g(x)
        trajectory[iter, ] &lt;- c(x)
        if (Print) {
            print(paste("-------------- Iteration ", iter, " -------------"))
            print(paste("f(x) = ", signif(fun_val, 3), " norm_grad = ", 
                signif(sqrt(sum(grad^2)), 3)))
        }
    }
    return(list(x.opt = x, trajectory = trajectory[1:iter, ], 
        iter = iter - 1))
}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>(out_back <span class="ot">&lt;-</span> <span class="fu">graddesc_backtracking</span>(f,g,<span class="at">x0=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">s=</span><span class="dv">2</span>,<span class="at">alpha=</span><span class="fl">0.25</span>, <span class="at">beta=</span><span class="fl">0.5</span>, <span class="at">epsilon=</span><span class="dv">10</span><span class="sc">^</span>{<span class="sc">-</span><span class="dv">5</span>}, <span class="at">Print=</span><span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$x.opt
[1] 0 0

$trajectory
     [,1] [,2]
[1,]    2    1
[2,]    0   -1
[3,]    0    0

$iter
[1] 2</code></pre>
</div>
</div>
<p>We can visualize the 3 different trajectories</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>plt<span class="ot">&lt;-</span><span class="fu">outer</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.2</span>,<span class="dv">2</span>,<span class="fl">0.01</span>), <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.01</span>), <span class="at">FUN=</span><span class="cf">function</span>(x,y){x<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>y<span class="sc">^</span><span class="dv">2</span>})</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.2</span>,<span class="dv">2</span>,<span class="fl">0.01</span>), <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.01</span>), plt)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(out_exact<span class="sc">$</span>trajectory[,<span class="dv">1</span>], out_exact<span class="sc">$</span>trajectory[,<span class="dv">2</span>], <span class="at">col=</span><span class="dv">2</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(out_exact<span class="sc">$</span>trajectory[,<span class="dv">1</span>], out_exact<span class="sc">$</span>trajectory[,<span class="dv">2</span>], <span class="at">col=</span><span class="dv">2</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(out_const<span class="sc">$</span>trajectory[,<span class="dv">1</span>], out_const<span class="sc">$</span>trajectory[,<span class="dv">2</span>])</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(out_const<span class="sc">$</span>trajectory[,<span class="dv">1</span>], out_const<span class="sc">$</span>trajectory[,<span class="dv">2</span>])</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(out_back<span class="sc">$</span>trajectory[,<span class="dv">1</span>], out_back<span class="sc">$</span>trajectory[,<span class="dv">2</span>], <span class="at">col=</span><span class="dv">3</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(out_back<span class="sc">$</span>trajectory[,<span class="dv">1</span>], out_back<span class="sc">$</span>trajectory[,<span class="dv">2</span>], <span class="at">col=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Week4-gradientI_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We know from the theory in notes that <span class="math display">\[f\in C_{||2\mathbf{A}||_2}^{1,1}\]</span>, i.e., <span class="math inline">\(\nabla f\)</span> is Lipschitz continuous with constant <span class="math inline">\(||2\mathbf{A}||=4\)</span> (the largest eigenvalue). So by the theory in the notes, we have that gradient descent with constant step size should converge whenever <span class="math inline">\(t\in (0, 2/4)\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>out_const <span class="ot">&lt;-</span> <span class="fu">graddesc_const_step</span>(f,g,<span class="at">x0=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">tbar=</span><span class="fl">0.4999</span>, <span class="at">epsilon=</span><span class="dv">10</span><span class="sc">^</span>{<span class="sc">-</span><span class="dv">5</span>}, <span class="at">Print=</span><span class="cn">FALSE</span>, <span class="at">maxiter=</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(out_const<span class="sc">$</span>iter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 32242</code></pre>
</div>
</div>
<p>The theorem doesn’t say it will diverge when <span class="math inline">\(t&gt;0.5\)</span> but that is usually the case in this problem.</p>
</div>
</div>
</div>
</section>
<section id="question-4" class="level2">
<h2 class="anchored" data-anchor-id="question-4">Question 4</h2>
<p>Now solve<span class="math display">\[\begin{align*}
        \min 0.01x_1^{2}+ x_2^{2}
\end{align*}\]</span> using gradient descent with backtracking using the same parameters as above. How many steps did this take till convergence?</p>
<p>Implement scaled gradient descent for this problem using the diagonal scaling matrix given in the notes. Try using a fixed step size of <span class="math inline">\(\bar{t}=1\)</span> - how many iterations are required for the method to converge?</p>
<div class="callout-note callout callout-style-simple no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>f<span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.01</span><span class="sc">*</span>x[<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>x[<span class="dv">2</span>]<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">0.02</span><span class="sc">*</span>x[<span class="dv">1</span>], <span class="dv">2</span><span class="sc">*</span>x[<span class="dv">2</span>])</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(numDeriv)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">c</span>(<span class="fl">1.23</span>, <span class="fl">2.34</span>) <span class="co"># its a good idea not to check your derivatives with x=1 or 0, as multiplicative or additive errors can then be missed.</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>numDeriv<span class="sc">::</span><span class="fu">grad</span>(f,x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0246 4.6800</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">g</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0246 4.6800</code></pre>
</div>
</div>
<p>Let’s first do gradient descent with backtracking as instructed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>out_back <span class="ot">&lt;-</span> <span class="fu">graddesc_backtracking</span>(f,g,<span class="at">x0=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">s=</span><span class="dv">2</span>,<span class="at">alpha=</span><span class="fl">0.25</span>, <span class="at">beta=</span><span class="fl">0.5</span>, <span class="at">epsilon=</span><span class="dv">10</span><span class="sc">^</span>{<span class="sc">-</span><span class="dv">5</span>}, <span class="at">Print=</span><span class="cn">FALSE</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">'Number of iterations required='</span>, out_back<span class="sc">$</span>iter))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Number of iterations required= 204"</code></pre>
</div>
</div>
<p>The condition number of this problem is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kappa</span>(numDeriv<span class="sc">::</span><span class="fu">hessian</span>(f, x), <span class="at">exact=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 100</code></pre>
</div>
</div>
<p>Now let’s use scaled gradient descent using the diagonal scaling matrix given in the notes:</p>
<p><span class="math display">\[\begin{align*}
    \left(\mathbf{D}^{k}\right)_{i i}=\left(\frac{\partial^{2} f\left(\mathbf{x}^{k}\right)}{\partial x_{i}^{2}}\right)^{-1}
\end{align*}\]</span></p>
<p>For <span class="math inline">\(t=1\)</span> we converge in a single step using this algorithm. For <span class="math inline">\(t=0.5\)</span> it takes a little longer, but still much faster than with the unscaled method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>D<span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diag</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="fl">0.02</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(scaled_graddesc_const_step)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (f, g, D, x0, tbar, epsilon, Print = TRUE, maxiter = 10^6) 
{
    print("SCALED GRADIENT DESCENT - CONSTANT STEPSIZE")
    x = x0
    iter = 1
    trajectory &lt;- matrix(0, nr = maxiter, nc = length(x0))
    trajectory[iter, ] &lt;- x0
    while (sum(g(x)^2) &gt; epsilon^2 &amp;&amp; iter &lt; maxiter) {
        iter = iter + 1
        x = x - tbar * D(x) %*% g(x)
        trajectory[iter, ] &lt;- x
        if (Print) {
            print(paste("-------------- Iteration ", iter, " -------------"))
            print(paste("f(x) = ", signif(f(x), 3), " norm_grad = ", 
                signif(sqrt(sum(g(x)^2)), 3)))
        }
    }
    return(list(x.opt = x, trajectory = trajectory[1:iter, ], 
        iter = iter - 1))
}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scaled_graddesc_const_step</span>(f,g,D,<span class="at">x0=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">tbar=</span><span class="dv">1</span>, <span class="at">epsilon=</span><span class="dv">10</span><span class="sc">^</span>{<span class="sc">-</span><span class="dv">5</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SCALED GRADIENT DESCENT - CONSTANT STEPSIZE"
[1] "-------------- Iteration  2  -------------"
[1] "f(x) =  0  norm_grad =  0"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$x.opt
     [,1]
[1,]    0
[2,]    0

$trajectory
     [,1] [,2]
[1,]    2    1
[2,]    0    0

$iter
[1] 1</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="question-5" class="level2">
<h2 class="anchored" data-anchor-id="question-5">Question 5</h2>
<p>Show that <span class="math inline">\(f(x)=\sqrt{1+x^{2}} \in C^{1,1}_1\)</span>.</p>
<div class="callout-note callout callout-style-simple no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We showed in the notes that a twice differentiable function is Lipschitz-continuous gradient with constant <span class="math inline">\(L\)</span> if and only if</p>
<p><span class="math display">\[\|\nabla^2 f(\mathbf{x})\|\leq L \forall \mathbf{x}\]</span></p>
<p>In this case we have <span class="math display">\[f'(x) = \frac{x}{\sqrt{1+x^2}}\]</span> and <span class="math display">\[f''(x) = \frac{1}{\sqrt{1+x^2}}-\frac{x^2}{(1+x^2)^{\frac{3}{2}}}=\frac{1}{(1+x^2)^\frac{3}{2}}\]</span> So we can see <span class="math inline">\(|f''(x) \leq 1\)</span> for all <span class="math inline">\(x\)</span>, and thus <span class="math inline">\(f\)</span> must have a Lipschitz-continuous gradient with a constant at most <span class="math inline">\(1\)</span>.</p>
</div>
</div>
</div>
</section>
<section id="question-6" class="level2">
<h2 class="anchored" data-anchor-id="question-6">Question 6</h2>
<p>Let <span class="math inline">\(f(\mathbf{x}) = \mathbf{x}^\top \mathbf{A}\mathbf{x}+ 2\mathbf{b}^\top \mathbf{x}+ c\)</span>, where <span class="math inline">\(\mathbf{A}\)</span> is a symmetric <span class="math inline">\(n\times n\)</span> matrix etc. Show that the smallest Lipschitz constant of <span class="math inline">\(\nabla f\)</span> is <span class="math inline">\(2||\mathbf{A}||\)</span>.</p>
<div class="callout-note callout callout-style-simple no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Again, computing the Hessian we find <span class="math inline">\(\nabla^2 f(\mathbf{x})=2\mathbf{A}\)</span>, and so <span class="math display">\[\|\nabla^2 f(\mathbf{x})\| = \|2\mathbf{A}\| = 2\|\mathbf{A}\|.\]</span> Thus <span class="math inline">\(f\in C^{2,1}_{2\|\mathbf{A}\|}\)</span> as required.</p>
</div>
</div>
</div>
</section>
<section id="question-7" class="level2">
<h2 class="anchored" data-anchor-id="question-7">Question 7</h2>
<p>In the notes we stated that for gradient descent we have <span class="math display">\[f(\mathbf{x}^{k+1}) \leq f(\mathbf{x}^k) -M \| \nabla f(\mathbf{x}^{k})||^2.\]</span> If <span class="math inline">\(f^* = \min f(\mathbf{x})\)</span>, show that <span class="math display">\[M \sum_{k=0}^N ||\nabla f(\mathbf{x}^k)||^2 \leq f(\mathbf{x}^0) - f^*\]</span> for some constant <span class="math inline">\(M\)</span>. <!-- see Nesterov book, p27.--> Now let <span class="math inline">\(g^*_N = \min_{0\leq k \leq N} \|\nabla f(\mathbf{x}^k)\|\)</span>. Show that <span class="math display">\[g^*_N \leq \frac{1}{\sqrt{N+1}} \left[ \frac{1}{M} (f(\mathbf{x}^0)-f^*)\right]^{\frac{1}{2}}\]</span> This result tells us about the rate of convergence of <span class="math inline">\(||\nabla f(\mathbf{x})||.\)</span></p>
<div class="callout-note callout callout-style-simple no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><span class="math display">\[\begin{align}
f(\mathbf{x}^0) - f^* \geq f(\mathbf{x}^0) - f(\mathbf{x}^{N+1}) &amp;= \sum_{i=0}^{N} f(\mathbf{x}^{i})-f(\mathbf{x}^{i+1})\\
&amp;\geq M\sum_{i=1}^N \|\nabla f(\mathbf{x}^k)\|^2
\end{align}\]</span></p>
<p>Rearranging we see that</p>
<p><span class="math display">\[\begin{align}
\frac{1}{M}\left(f(\mathbf{x}^0) - f^*\right) &amp;\geq \sum_{i=1}^N \|\nabla f(\mathbf{x}^k)\|^2\\
&amp;\geq (N+1)g_N^*
\end{align}\]</span></p>
<p>Taking square roots and rearranging gives the required result.</p>
</div>
</div>
</div>
</section>
<section id="question-8" class="level2">
<h2 class="anchored" data-anchor-id="question-8">Question 8</h2>
<p>Implement the Rosenbrock example from the notes.</p>
<div class="callout-note callout callout-style-simple no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This is a classic example of an ill-conditioned problem:</p>
<p><span class="math display">\[\begin{align*}
    \min \left\{f\left(x_{1}, x_{2}\right)=100\left(x_{2}-x_{1}^{2}\right)^{2}+\left(1-x_{1}\right)^{2}\right\}
\end{align*}\]</span></p>
<p>Let’s code the function, its gradient, and check our calculation numerically.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>f<span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">100</span><span class="sc">*</span>(x[<span class="dv">2</span>]<span class="sc">-</span>x[<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>(<span class="dv">1</span><span class="sc">-</span>x[<span class="dv">1</span>])<span class="sc">^</span>{<span class="dv">2</span>}</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>g<span class="ot">&lt;-</span><span class="cf">function</span>(x){</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  dx1 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">400</span><span class="sc">*</span>x[<span class="dv">1</span>]<span class="sc">*</span>(x[<span class="dv">2</span>]<span class="sc">-</span>x[<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>x[<span class="dv">1</span>])</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  dx2 <span class="ot">&lt;-</span> <span class="dv">200</span><span class="sc">*</span>(x[<span class="dv">2</span>]<span class="sc">-</span>x[<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(dx1,dx2))</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(numDeriv)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">c</span>(<span class="fl">2.23</span>, <span class="fl">1.24</span>)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="fu">grad</span>(f,x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3332.207 -746.580</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">g</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3332.207 -746.580</code></pre>
</div>
</div>
<p>The condition number of this problem is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kappa</span>(numDeriv<span class="sc">::</span><span class="fu">hessian</span>(f, x), <span class="at">exact=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 105.6324</code></pre>
</div>
</div>
<p>If we then do gradient descent with backtracking we find we need a lot of iterations to converge:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>out_back <span class="ot">&lt;-</span> <span class="fu">graddesc_backtracking</span>(f,g,<span class="at">x0=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="at">s=</span><span class="dv">2</span>,<span class="at">alpha=</span><span class="fl">0.25</span>, </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">beta=</span><span class="fl">0.5</span>, <span class="at">epsilon=</span><span class="dv">10</span><span class="sc">^</span>{<span class="sc">-</span><span class="dv">5</span>}, <span class="at">Print=</span><span class="cn">FALSE</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"-----"</span>, out_back<span class="sc">$</span>iter, <span class="st">"Iterations required -----"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "----- 6890 Iterations required -----"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>plt<span class="ot">&lt;-</span><span class="fu">outer</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">2.5</span>,<span class="fl">0.01</span>), <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="fl">0.01</span>), <span class="at">FUN=</span><span class="cf">function</span>(x,y){x<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>y<span class="sc">^</span><span class="dv">2</span>})</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">2.5</span>,<span class="fl">0.01</span>), <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="fl">0.01</span>), plt)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(out_back<span class="sc">$</span>trajectory[,<span class="dv">1</span>], out_back<span class="sc">$</span>trajectory[,<span class="dv">2</span>], <span class="at">col=</span><span class="dv">3</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(out_back<span class="sc">$</span>trajectory[,<span class="dv">1</span>], out_back<span class="sc">$</span>trajectory[,<span class="dv">2</span>], <span class="at">col=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Week4-gradientI_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In this case, using a diagonal scaling matrix for the gradients doesn’t work particularly well either. We will see an approach that works well for this problem next week.</p>
</div>
</div>
</div>
</section>
<section id="question-9" class="level2">
<h2 class="anchored" data-anchor-id="question-9">Question 9</h2>
<p>It is possible to prove that having a Lipschitz continuous gradient with constant <span class="math inline">\(L\)</span> is equivalent to <span class="math display">\[|f(\mathbf{x})-f(\mathbf{x}_0) - \nabla f(\mathbf{x}_0)^\top (\mathbf{x}-\mathbf{x}_0)| \leq \frac{L}{2} \|\mathbf{x}-\mathbf{x}_0\|^2_2.\]</span> By removing the absolute signs, show that we can bound any <span class="math inline">\(f\in C^{1,1}\)</span> above and below by a quadratic function that are tight at <span class="math inline">\(\mathbf{x}_0\)</span>. In other words, show that there exists quadratic functions <span class="math inline">\(u(\mathbf{x})\)</span> and <span class="math inline">\(l(\mathbf{x})\)</span> with <span class="math display">\[l(\mathbf{x})\leq f(\mathbf{x})\leq u(\mathbf{x})\qquad \mbox{ and }\qquad f(\mathbf{x}_0)=u(\mathbf{x}_0)=l(\mathbf{x}_0).\]</span></p>
<p>Draw a picture.</p>
<div class="callout-note callout callout-style-simple no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Let’s fix some <span class="math inline">\(\mathbf{x}_0\)</span>. Then the given inequality tells us that <span class="math display">\[f(\mathbf{x})-f(\mathbf{x}_0) - \nabla f(\mathbf{x}_0)^\top (\mathbf{x}-\mathbf{x}_0) \leq \frac{L}{2} \|\mathbf{x}-\mathbf{x}_0\|^2_2.\]</span> and <span class="math display">\[f(\mathbf{x})-f(\mathbf{x}_0) - \nabla f(\mathbf{x}_0)^\top (\mathbf{x}-\mathbf{x}_0) \geq -\frac{L}{2} \|\mathbf{x}-\mathbf{x}_0\|^2_2.\]</span></p>
<p>Define <span class="math display">\[\begin{align}
u(\mathbf{x})&amp;= f(\mathbf{x}_0) + \nabla f(\mathbf{x}_0)^\top (\mathbf{x}-\mathbf{x}_0) + \frac{L}{2} \|\mathbf{x}-\mathbf{x}_0\|^2_2\\
l(\mathbf{x}) &amp;= f(\mathbf{x}_0) + \nabla f(\mathbf{x}_0)^\top (\mathbf{x}-\mathbf{x}_0) - \frac{L}{2} \|\mathbf{x}-\mathbf{x}_0\|^2_2
\end{align}\]</span></p>
<p>Then we have bound <span class="math inline">\(f\)</span> between two quadratic function that are tight at <span class="math inline">\(\mathbf{x}_0\)</span>: <span class="math display">\[l(\mathbf{x})\leq f(\mathbf{x})\leq u(\mathbf{x}) \quad \mbox{ for all }\mathbf{x}\]</span></p>
<p>This gives us one way to think about the functions in <span class="math inline">\(C^{1,1}\)</span>. As an example, consider the function from question 5.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">+</span>x<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span> <span class="cf">function</span>(x){x<span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">+</span>x<span class="sc">^</span><span class="dv">2</span>)}</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>L<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>x0<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(x0)<span class="sc">+</span><span class="fu">df</span>(x0)<span class="sc">*</span>(x<span class="sc">-</span>x0)<span class="sc">+</span>L<span class="sc">/</span><span class="dv">2</span><span class="sc">*</span>(x<span class="sc">-</span>x0)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(x0)<span class="sc">+</span><span class="fu">df</span>(x0)<span class="sc">*</span>(x<span class="sc">-</span>x0)<span class="sc">-</span>L<span class="sc">/</span><span class="dv">2</span><span class="sc">*</span>(x<span class="sc">-</span>x0)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>xvals <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>,<span class="fl">0.01</span>)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(xvals, <span class="fu">f</span>(xvals), <span class="at">type=</span><span class="st">'l'</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>))</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xvals, <span class="fu">u</span>(xvals), <span class="at">col=</span><span class="dv">2</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xvals, <span class="fu">l</span>(xvals), <span class="at">col=</span><span class="dv">2</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xvals, <span class="fu">f</span>(x0)<span class="sc">+</span>(xvals<span class="sc">-</span>x0)<span class="sc">*</span><span class="fu">df</span>(x0), <span class="at">col=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Week4-gradientI_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The red lines show the quadratic bounds formed at <span class="math inline">\(x_0=1\)</span>, and the blue line shows the tangent line at <span class="math inline">\(x_0=1\)</span>.</p>
</div>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



<script src="Week4-gradientI_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>